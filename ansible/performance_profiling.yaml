---
- name: Performance Profiling
  hosts: Workers
  gather_facts: no
  become: yes

  tasks: 

    - name: Profiling --> Jetson Nano
      delegate_to: LoudJetson0
      run_once: true
      ignore_errors: yes
      block:
        - name: Run the Python script for the performance measurements
          shell: sudo python3 /home/iloudaros/LoudVA/tests/Test_Nano_Performance.py > /home/iloudaros/LoudVA/measurements/Performance.log 2>&1

        - name : Copy the log files from remote to local
          shell: (cd /home/iloudaros/LoudVA/measurements; find . -maxdepth 1 -type f) | cut -d'/' -f2
          register: files_to_copy

        - fetch: src=/home/iloudaros/LoudVA/measurements/{{ item }} dest=~/LoudVA/measurements
          with_items: "{{ files_to_copy.stdout_lines }}"

    - name: Profiling --> Jetson Xavier NX
      delegate_to: xavier-nx-00
      run_once: true
      ignore_errors: yes
      block:
        - debug:
            msg: "Running the Python script for the performance measurements on Jetson Xavier NX"

    - name: Profiling --> Jetson Xavier AGX
      delegate_to: agx-xavier-00 
      run_once: true
      ignore_errors: yes
      block:
        - debug:
            msg: "Running the Python script for the performance measurements on Jetson Xavier AGX"

      
      
